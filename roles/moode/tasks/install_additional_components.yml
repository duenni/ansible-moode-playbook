
#MiniDLNA
- name: MiniDLNA - apt-get
  become: true
  shell: apt-get -y -o Dpkg::Options::="--force-confdef" -o Dpkg::Options::="--force-confold" install minidlna

- name: MiniDLNA - systemd
  become: true
  systemd:
    name: minidlna
    state: stopped
    enabled: no

- name: MiniDLNA - install djmount
  become: true
  apt: name=djmount state=present

#Ashuffle
- name: Autoshuffle - git checkout autoshuffle
  become: true
  git:
    repo:  git://github.com/Joshkunz/ashuffle.git
    dest: /home/pi/ashuffle

- name: Autoshuffle - make
  become: true
  shell: chdir=/home/pi/ashuffle make creates=/home/pi/ashuffle/ashuffle

- name: Ashuffle - copy package
  become: true
  copy:
    src: /home/pi/ashuffle/ashuffle
    dest: /usr/local/bin/ashuffle
    remote_src: yes

- name: Ashuffle - del git dir
  become: true
  file: 
    state: absent
    path: /home/pi/ashuffle

#MPD Audio Scrobbler
- name: MPD Audio Scrobbler - git checkout autoshuffle
  become: true
  git:
    repo:  git://github.com/hrkfdn/mpdas
    dest: /home/pi/mpdas

- name: MPD Audio Scrobbler - make
  become: true
  shell: chdir=/home/pi/mpdas make creates=/home/pi/mpdas/mpdas

- name: MPD Audio Scrobbler - copy package
  become: true
  copy:
    src: /home/pi/mpdas/mpdas
    dest: /usr/local/bin/mpdas
    remote_src: yes

- name: MPD Audio Scrobbler - copy config file
  become: true
  copy: 
    src: /home/pi/rel-stretch/usr/local/etc/mpdasrc.default
    dest: /usr/local/etc/mpdasrc
    mode: 0755
    remote_src: yes

#Shairport-sync
- name: Shairport-sync - install packages
  become: true
  apt: name={{ item }} state=present
  with_items:
    - autoconf
    - libtool
    - libdaemon-dev
    - libasound2-dev
    - libpopt-dev
    - libconfig-dev
    - avahi-daemon
    - libavahi-client-dev
    - libssl-dev
    - libsoxr-dev

- name: Shairport-sync - git checkout shairport-sync
  become: true
  git:
    repo:  git://github.com/mikebrady/shairport-sync.git
    dest: /home/pi/shairport-sync

- name: Shairport-sync - autoreconf 
  become: true
  shell: "{{ item }}"
  args:
    chdir: /home/pi/shairport-sync
  with_items:
    - autoreconf -i -f
    - ./configure --with-alsa --with-avahi --with-ssl=openssl --with-soxr --with-metadata --with-stdout --with-systemd
    - make
    - make install

- name: Shairport-sync - systemd
  become: true
  systemd:
    name: shairport-sync
    state: stopped
    enabled: no

- name: Shairport-sync - copy config file
  become: true
  copy: 
    src: /home/pi/rel-stretch/usr/local/etc/shairport-sync.conf
    dest: /usr/local/etc/shairport-sync.conf
    remote_src: yes

#Squeezelite
- name: Squeezelite - copy precompiled binarys armv6l
  become: true
  copy: 
    src: /home/pi/rel-stretch/other/squeezelite/squeezelite-1.8.7-999-armv6l
    dest: /usr/local/bin/squeezelite-armv6l
    remote_src: yes
  when: "ansible_architecture == 'armv6l'"

- name: Squeezelite - copy precompiled binarys armv7l
  become: true
  copy: 
    src: /home/pi/rel-stretch/other/squeezelite/squeezelite-1.8.7-999-armv7l
    dest: /usr/local/bin/squeezelite-armv7l
    remote_src: yes
  when: "ansible_architecture == 'armv7l'"

#Upmpdcli